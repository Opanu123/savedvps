name: Auto VPS Creator with MEGA Backup

on: workflow_dispatch: schedule: - cron: "0 */6 * * *" push: branches: - main

jobs: create-vps: runs-on: ubuntu-latest

steps:
  - name: Checkout
    uses: actions/checkout@v3

  - name: Setup Python 3.10
    uses: actions/setup-python@v4
    with:
      python-version: '3.10'

  - name: Install Dependencies
    run: |
      sudo apt update
      sudo apt install -y tmate zip
      python3 -m pip install --upgrade pip
      pip install mega.py

  - name: Setup tmate and Save SSH
    run: |
      tmate -S /tmp/tmate.sock new-session -d
      tmate -S /tmp/tmate.sock wait tmate-ready
      tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}' > ssh.txt
      cat ssh.txt

  - name: Upload SSH File
    uses: actions/upload-artifact@v4
    with:
      name: ssh
      path: ssh.txt

  - name: Create Fake Minecraft World
    run: |
      mkdir -p minecraft/world
      echo "This is a test world" > minecraft/world/readme.txt

  - name: Zip Minecraft Folder
    run: |
      mkdir -p .backup
      zip -r .backup/autovps.zip minecraft
      chmod 644 .backup/autovps.zip

  - name: Upload Backup to MEGA
    env:
      MEGA_EMAIL: ${{ secrets.MEGA_EMAIL }}
      MEGA_PASSWORD: ${{ secrets.MEGA_PASSWORD }}
    run: |
      python3 - <<EOF

from mega import Mega mega = Mega() m = mega.login(email="${{ secrets.MEGA_EMAIL }}", password="${{ secrets.MEGA_PASSWORD }}") m.upload(".backup/autovps.zip") EOF

- name: Keep VPS Session Alive
    run: |
      while true; do echo "ðŸŸ¢ VPS Running - $(date)"; sleep 60; done

